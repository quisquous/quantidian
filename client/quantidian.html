<head>
</head>

<body>
  {{#if currentUser}}
    {{#isolate}}
      <div class="page">
        {{> actionBar}}
        <div class="content inset">
          {{renderPage}}
        </div>
      </div>
    {{/isolate}}
  {{else}}
    {{loginButtons}}
  {{/if}}
</body>

<template name="actionBar">
  <header class="action-bar">
    {{#if isPage "main"}}
      <a href="#" class="app-icon action"><i class="icon-star-full"></i></a>
    {{else}}
      <a href="/" class="app-icon action up">
        <i class="chevron"></i>
        <i class="icon-star-full"></i>
      </a>
    {{/if}}
    {{#if subtitle}}
      <h2 class="title">{{title}} <span class="subtitle">{{subtitle}}</span></h2>
    {{else}}
      <h1 class="title">{{title}}</h1>
    {{/if}}
    <ul class="actions pull-right">
      <li>
        <a href="/subscribe" class="action" title="Subscriptions">
          <i class="icon-new"></i>
        </a>
      </li>
      <li>
        <a href="/editor" class="action" title="Editor">
          <i class="icon-edit"></i>
        </a>
      </li>
      <li>
        <a href="/logs" class="action" title="Logs">
          <i class="icon-view-as-list"></i> </a>
      </li>
    </ul>
  </header>
</template>

<template name="main">
  {{#each subscribed}}
    <a href="/category/{{_id}}">
      <button type="button" class="btn btn-block">{{name}}</button>
    </a>
  {{/each}}
  {{> logEntries}}
</template>

<template name="logEntries">
  <ul class="list inset">
    <li class="list-divider">Recent logs</li>
      {{#each recentLogs}}
        <li class="list-item-single-line">{{stringifyLog}}</li>
      {{/each}}
  </ul>
</template>

<template name="category">
  {{#with categoryObj}}
    <div class="form-flex inset">
      <p>{{longdesc}}</p>
      {{#each questions}}
        <label>{{label}}</label>
        <!-- FIXME: this should probably be JS -->
        {{#if typeIs "multiplechoice"}}
          <div class="radiogroup">
          {{#each choices}}
            <button class="userinput btn radioitem" value="{{value}}">{{desc}}</button>
          {{/each}}
          </div>
        {{/if}}
        {{#if typeIs "text"}}
          <input class="input-text userinput active" type="text" placeholder="Enter some text"</input>
        {{/if}}
      {{/each}}
      <div class="form-actions">
        <button type="submit" class="btn btn-block save">Save</button>
      </div>
    </div>
  {{/with}}
</template>

<template name="editor">
  <div class="page">
    <div class="content">
      {{#with editor}}
        <div>
          <input class="categoryname" type="text" placeholder="Category Name" value="{{name}}"></input>
        </div>
        <div>
          <input class="categorydesc" type="text" placeholder="Category Description" value="{{longdesc}}"></input>
        </div>
        <button class="addquestion btn btn-large">Add Question</button>
        {{#each questions}}
          {{> editorQuestion}}
        {{/each}}
        {{#if questions}}
          <button class="savecategory btn btn-large btn-primary">Save</button>
        {{/if}}
      {{/with}}
    </div>
  </div>
</template>

<template name="editorQuestion">
  <div class="editorquestion">
    <p>Question {{num}}</p>
    <div>
      <input class="prompt" type="text" placeholder="Enter a prompt..." value="{{label}}"></input>
    </div>
    <select class="type">
      {{#each questionTypes}}
        <option value="{{key}}">{{name}}</option>
      {{/each}}
    </select>
    {{#if typeIs "multiplechoice"}}
      <button class="addchoice btn">Add Choice</button>
      {{#each choices}}
        <div class="editorchoice" num="{{num}}">
          <p>Choice {{num}}</p>
          <input class="choicetext" type="text" placeholder="Choice text" value="{{desc}}"></input>
          <input class="choicevalue" type="text" placeholder="Choice value" value="{{value}}"></input>
          <div>
            <button class="deletechoice btn">Delete Choice</button>
          </div>
        </div>
      {{/each}}
    {{/if}}
    <div>
      <label class="checkbox">
        Optional <input type="checkbox" class="optional"></input>
      </label>
    </div>
    <div>
      <button class="deletequestion btn">Delete Question</button>
    </div>
  </div>
</template>
