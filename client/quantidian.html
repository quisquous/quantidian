<head>
</head>

<body>
  {{#if currentUser}}
    {{#isolate}}
      <div class="page">
        {{> actionBar}}
        <div class="content inset">
          {{renderPage}}
        </div>
      </div>
    {{/isolate}}
  {{else}}
    {{loginButtons}}
  {{/if}}
</body>

<template name="actionBar">
  <header class="action-bar">
    {{#if isPage "main"}}
      <a href="#" class="app-icon action"><i class="icon-star-full"></i></a>
    {{else}}
      <a href="/" class="app-icon action up">
        <i class="chevron"></i>
        <i class="icon-star-full"></i>
      </a>
    {{/if}}
    {{#if subtitle}}
      <h2 class="title">{{title}} <span class="subtitle">{{subtitle}}</span></h2>
    {{else}}
      <h1 class="title">{{title}}</h1>
    {{/if}}
    <ul class="actions pull-right">
      <li>
        <a href="/subscribe" class="action" title="Subscriptions">
          <i class="icon-new"></i>
        </a>
      </li>
      <li>
        <a href="/editor" class="action" title="Editor">
          <i class="icon-edit"></i>
        </a>
      </li>
      <li>
        <a href="/logs" class="action" title="Logs">
          <i class="icon-view-as-list"></i> </a>
      </li>
    </ul>
  </header>
</template>

<template name="main">
  {{#each subscribed}}
    <a href="/category/{{_id}}">
      <button type="button" class="btn btn-block">{{name}}</button>
    </a>
  {{/each}}
  {{> logEntries}}
</template>

<template name="logEntries">
  <ul class="list inset">
    <li class="list-divider">Recent logs</li>
      {{#each recentLogs}}
        <li class="list-item-single-line">{{stringifyLog}}</li>
      {{/each}}
  </ul>
</template>

<template name="category">
  {{#with categoryObj}}
    <div class="form-flex inset">
      <p>{{longdesc}}</p>
      {{#each questions}}
        <label>{{label}}</label>
        <!-- FIXME: this should probably be JS -->
        {{#if typeIs "multiplechoice"}}
          <div class="radiogroup">
          {{#each choices}}
            <button class="userinput btn radioitem" value="{{value}}">{{desc}}</button>
          {{/each}}
          </div>
        {{/if}}
        {{#if typeIs "text"}}
          <input class="input-text userinput active" type="text" placeholder="Enter some text"</input>
        {{/if}}
      {{/each}}
      <div class="form-actions">
        <button type="submit" class="btn btn-block save">Save</button>
      </div>
    </div>
  {{/with}}
</template>

<template name="editor">
  {{#with editor}}
    <p>Create a New Data Category</p>
    <label>Category Name</label>
    <input class="categoryname input-text" type="text" placeholder="A pithy label for this category, e.g. Mood" value="{{name}}"></input>

    <label>Category Description</label>
    <input class="categorydesc input-text" type="text" placeholder="Longer explanatory text" value="{{longdesc}}"></input>

    {{#each questions}}
      {{> editorQuestion}}
    {{/each}}
    <!-- FIXME: url highlighting here looks weird -->
    <a href="#" class="addquestion action"><i class="icon-new"></i>Add Another Question</a>

    {{#if questions}}
      <!-- FIXME: this should maybe be a bottom nav item? -->
      <button class="savecategory btn btn-block">Save</button>
    {{/if}}
  {{/with}}
</template>

<template name="editorQuestion">
  <a href="#" class="rightflushicon deletequestion action"><i class="icon-remove"></i></a>
  <div class="shortlabel">
    <label>Question {{num}}</label>
  </div>
  <div class="inset editorquestion">

    <label>Question Text</label>
    <input class="input-text prompt" type="text" placeholder="Enter a prompt" value="{{label}}"></input>

    <div class="radiogroup optional">
      <button class="userinput btn radioitem {{#unless isOptional}}active{{/unless}}" value="0">Required</button>
      <button class="userinput btn radioitem {{#if isOptional}}active{{/if}}" value="1">Optional</button>
    </div>

    <label>Question Type</label>
    <div class="radiogroup type">
      <button class="userinput btn radioitem {{#if typeIs "multiplechoice"}}active{{/if}}" value="multiplechoice">Multiple Choice</button>
      <button class="userinput btn radioitem {{#if typeIs "text"}}active{{/if}}" value="text">Text</button>
    </div>

    {{#if typeIs "multiplechoice"}}
      {{#each choices}}
        <div class="editorchoice inset" num="{{num}}">
          <a href="#" class="rightflushicon deletechoice action"><i class="icon-remove"></i></a>
          <label>Choice {{num}}</label>
          <input class="choicetext input-text" type="text" placeholder="Choice text" value="{{desc}}"></input>
          <input class="choicevalue input-text" type="text" placeholder="Choice value" value="{{value}}"></input>
        </div>
      {{/each}}
      <!-- FIXME: url highlighting here looks weird -->
      <a href="#" class="addchoice action"><i class="icon-new"></i>Add Another Choice</a>
    {{/if}}
  </div>
</template>
